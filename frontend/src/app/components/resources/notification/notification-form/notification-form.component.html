<div class="form-card">
  <!-- Header -->
  <div class="form-header">
    <button class="close-btn" (click)="onCancel()" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <div class="title-container">
      <span class="title-dot"></span>
      <h2 class="form-title">{{ editMode ? "Edit Notification" : "New Notification" }}</h2>
      <span class="title-dot"></span>
    </div>
  </div>

  <!-- Content -->
  <mat-dialog-content class="form-content">
    <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
      <!-- Subject -->
      <div class="form-group">
        <label for="subject" class="form-label">Subject <span class="required">*</span></label>
        <div class="input-wrapper">
          <input type="text" id="subject" formControlName="subject" class="form-input" placeholder="Enter subject (min 5 characters)" />
        </div>
        <div class="error-message" *ngIf="formGroup.get('subject')?.invalid && formGroup.get('subject')?.touched">
          Subject is required (min 5 characters)
        </div>
      </div>

      <!-- Recipient -->
      <div class="form-group">
        <label for="recipient" class="form-label">Recipient Email <span class="required">*</span></label>
        <div class="input-wrapper">
          <input type="email" id="recipient" formControlName="recipient" class="form-input" placeholder="Enter email address" />
        </div>
        <div class="error-message" *ngIf="formGroup.get('recipient')?.invalid && formGroup.get('recipient')?.touched">
          Valid email is required
        </div>
      </div>

      <!-- Notification Type -->
      <div class="form-group">
        <label for="notificationType" class="form-label">Type <span class="required">*</span></label>
        <div class="input-wrapper">
          <select id="notificationType" formControlName="notificationType" class="form-select">
            <option *ngFor="let type of notificationTypes" [value]="type">
              {{ type === 'incident_notification' ? 'Incident Notification' : 'Capacity Notification' }}
            </option>
          </select>
        </div>
      </div>

      <!-- Body -->
      <div class="form-group">
        <label for="body" class="form-label">Message <span class="required">*</span></label>
        <div class="input-wrapper">
          <textarea id="body" formControlName="body" class="form-input form-textarea" placeholder="Enter message (min 10 characters)" rows="4"></textarea>
        </div>
        <div class="error-message" *ngIf="formGroup.get('body')?.invalid && formGroup.get('body')?.touched">
          Message is required (min 10 characters)
        </div>
      </div>

      <!-- Related Entities Row -->
      <div style="display: flex; gap: 1.5rem">
        <div class="form-group" style="flex: 1">
          <label for="userId" class="form-label">Related User</label>
          <div class="input-wrapper">
            <select id="userId" formControlName="userId" class="form-select">
              <option value="">None</option>
              <option *ngFor="let user of users" [value]="user.id">{{ user.userName }}</option>
            </select>
          </div>
        </div>

        <div class="form-group" style="flex: 1">
          <label for="containerId" class="form-label">Related Container</label>
          <div class="input-wrapper">
            <select id="containerId" formControlName="containerId" class="form-select">
              <option value="">None</option>
              <option *ngFor="let container of containers" [value]="container.id">
                Container #{{ container.id?.substring(0, 8) }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Related Incident -->
      <div class="form-group">
        <label for="incidentId" class="form-label">Related Incident</label>
        <div class="input-wrapper">
          <select id="incidentId" formControlName="incidentId" class="form-select">
            <option value="">None</option>
            <option *ngFor="let incident of incidents" [value]="incident.id">
              {{ incident.description?.substring(0, 50) }}...
            </option>
          </select>
        </div>
      </div>
    </form>
  </mat-dialog-content>

  <!-- Actions -->
  <div class="form-actions">
    <button type="button" class="btn-submit" [disabled]="formGroup.invalid || isLoading" (click)="onSubmit()">
      {{ isLoading ? "Sending..." : editMode ? "Update Notification" : "Send Notification" }}
    </button>
    <button type="button" class="btn-cancel" (click)="onCancel()">Cancel</button>
  </div>
</div>
